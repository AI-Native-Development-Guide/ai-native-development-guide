<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="GitHub Copilot makes it incrediblly easy to modify code, but the suggested code is not always correct even if it looks good. Writing tests is very important before refactoring it. This is no different when using GitHub Copilot."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="Writing test code before refactoring"><meta property="og:description" content="GitHub Copilot makes it incrediblly easy to modify code, but the suggested code is not always correct even if it looks good. Writing tests is very important before refactoring it. This is no different when using GitHub Copilot."><meta property="og:type" content="article"><meta property="og:url" content="/refactoring/writing-test-code-before-refactoring/"><meta property="article:section" content="refactoring"><meta property="article:modified_time" content="2023-12-20T20:36:53+09:00"><title>Writing test code before refactoring | GitHub Copilot Patterns & Exercises</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=alternate hreflang=ja href=/ja/refactoring/writing-test-code-before-refactoring/ title=リファクタリング前にテストコードを書く><link rel=stylesheet href=/book.min.8405c9cb7e449878e091f493a635c7a0b8c54141b1c9c7fc7c4e5da78e983056.css><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>GitHub Copilot Patterns & Exercises</span></a></h2><ul class=book-languages><li><input type=checkbox id=languages class=toggle>
<label for=languages class="flex justify-between"><a role=button class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
English</a></label><ul><li><a href=/ja/refactoring/writing-test-code-before-refactoring/>Japanese</a></li></ul></li></ul><div style=margin-bottom:-30px;margin-top:-10px;display:flex><img src=https://i.creativecommons.org/l/by-sa/4.0/88x31.png height=20 style=display:flex;margin-right:6px>
<iframe src="https://ghbtns.com/github-btn.html?user=yuhattor&repo=copilot-patterns&type=star&count=true" frameborder=0 scrolling=0 width=100 height=30 title=GitHub></iframe></div><ul><li><p>About</p><ul><li><a href=/>Introduction</a></li><li><a href=/CONTRIBUTING/>Contributing to the Project</a></li></ul></li><li><p>General</p><ul><li><a href=/general/code-completion/>Code completion</a></li><li><a href=/general/comment-to-code/>Comment to code</a></li><li><a href=/general/code-to-comment/>Code to comment</a></li><li><a href=/general/quick-qna/>Quick Q&amp;A</a></li><li><a href=/general/regular-expression/>Regular expression</a></li><li><a href=/general/language-translation/>Language translation</a></li><li><a href=/general/type-hinting/>Type hinting</a></li><li><a href=/general/code-to-document/>Code to document</a></li><li><a href=/general/object-generation-from-structured-data/>Object generation from structured data</a></li><li><a href=/general/showing-examples/>Showing examples</a></li></ul></li><li><p>Client Side Tips</p><ul><li><a href=/client-tips/copilot-snippet-handling/>Copilot snippet handling</a></li><li><a href=/client-tips/github-copilot-shortcuts/>GitHub Copilot Shortcuts</a></li><li><a href=/client-tips/go-to-definition/>Go to definition</a></li><li><a href=/client-tips/pin-the-file-you-need/>Pin the files you need</a></li></ul></li><li><p>Design Patterns</p><ul><li><a href=/design-pattern/ai-readable-naming-convention/>AI readable naming convention</a></li><li><a href=/design-pattern/consistent-coding-style/>Consistent coding style</a></li><li><a href=/design-pattern/high-level-architecture-first/>High-level architecture first</a></li><li><a href=/design-pattern/working-on-small-chunk/>Working on small chunks</a></li><li><a href=/design-pattern/context-less-architecture/>Context-less Architecture</a></li><li><a href=/design-pattern/eliminating-a-tiny-oss-dependency/>Eliminating a tiny OSS dependency</a></li></ul></li><li><p>Collaboration</p><ul><li><a href=/collaboration/ai-friendly-documentation/>AI friendly documentation</a></li><li><a href=/collaboration/coaching-on-prompts/>Coaching on prompts</a></li></ul></li><li><p>Test</p><ul><li><a href=/testing/creating-unit-tests/>Creating unit tests</a></li><li><a href=/testing/specify-test-valiation/>Specify how to generate test code</a></li><li><a href=/testing/writing-failure-case-first/>Writing failure case first</a></li><li><a href=/testing/writing-test-cases-in-natural-language-first/>Writing test cases in natural language first</a></li><li><a href=/testing/test-only-what-is-necessary/>Test only what is necessary</a></li></ul></li><li><p>Refactoring</p><ul><li><a href=/refactoring/writing-test-code-before-refactoring/ class=active>Writing test code before refactoring</a></li><li><a href=/refactoring/making-the-calculation-part-independent/>Making the calculation part independent</a></li><li><a href=/refactoring/asking-with-open-ended-questions/>Asking with open-ended questions</a></li></ul></li><li><p>Archived Version</p><ul><li><a href=https://ai-native-development.gitbook.io/archived/>English 🇬🇧</a></li><li><a href=https://ai-native-development.gitbook.io/archived/german>German 🇩🇪</a></li><li><a href=https://ai-native-development.gitbook.io/archived/spanish>Spanish 🇪🇸</a></li><li><a href=https://ai-native-development.gitbook.io/archived/french>French 🇫🇷</a></li><li><a href=https://ai-native-development.gitbook.io/archived/italy>Italy 🇮🇹</a></li><li><a href=https://ai-native-development.gitbook.io/archived/japanese>Japanese 🇯🇵</a></li><li><a href=https://ai-native-development.gitbook.io/archived/portuguese>Portuguese 🇵🇹</a></li><li><a href=https://ai-native-development.gitbook.io/archived/chinese>Chinese 🇨🇳</a></li></ul></li><li><p><a href=https://github.com/yuhattor/copilot-patterns>GitHub</a></p></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Writing test code before refactoring</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#writing-test-code-before-refactoring>Writing test code before refactoring</a><ul><li><a href=#description>Description</a></li><li><a href=#exercise>Exercise</a></li><li><a href=#checklist-for-further-learning>Checklist for Further Learning</a></li></ul></li></ul></li></ul></nav></aside></header><blockquote class=note>Hi!👋 This is a community-driven, beta document, NOT an official GitHub document. Your contribution to make this even better is super welcome!🚀
Please dive in and contribute🙌</blockquote><article class="markdown book-article"><h2 id=writing-test-code-before-refactoring>Writing test code before refactoring
<a class=anchor href=#writing-test-code-before-refactoring>#</a></h2><p><a href=https://github.com/orgs/AI-Native-Development/projects/1/><img src=https://img.shields.io/badge/Lv2-Practically_Viable_Pattern-green></a></p><h3 id=description>Description
<a class=anchor href=#description>#</a></h3><p>In the modern world of software development, refactoring can be seen as a fun and engaging task, especially with tools like GitHub Copilot at your disposal. It&rsquo;s so easy to dive in and make changes, but without proper tests, even the most promising code modification can lead to unexpected results. This pattern emphasizes the importance of writing tests before refactoring code to ensure that the functionality remains consistent. Think of tests as your safety net; they catch the problems before they become catastrophic.</p><h4 id=example>Example
<a class=anchor href=#example>#</a></h4><p>Suppose you have a function that calculates the total price of a shopping cart, and you want to refactor it for better clarity. Here&rsquo;s the original code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>total_price</span>(items):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> sum(item[<span style=color:#e6db74>&#39;price&#39;</span>] <span style=color:#f92672>*</span> item[<span style=color:#e6db74>&#39;quantity&#39;</span>] <span style=color:#66d9ef>for</span> item <span style=color:#f92672>in</span> items)
</span></span></code></pre></div><p>Before refactoring, write tests to ensure that the existing functionality is preserved:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_total_price</span>():
</span></span><span style=display:flex><span>    items <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#39;price&#39;</span>: <span style=color:#ae81ff>5</span>, <span style=color:#e6db74>&#39;quantity&#39;</span>: <span style=color:#ae81ff>2</span>},
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#39;price&#39;</span>: <span style=color:#ae81ff>3</span>, <span style=color:#e6db74>&#39;quantity&#39;</span>: <span style=color:#ae81ff>1</span>}
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> total_price(items) <span style=color:#f92672>==</span> <span style=color:#ae81ff>13</span>
</span></span></code></pre></div><p>Now you can refactor the code to make it more readable:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>total_price</span>(items):
</span></span><span style=display:flex><span>    total <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> item <span style=color:#f92672>in</span> items:
</span></span><span style=display:flex><span>        total <span style=color:#f92672>+=</span> item[<span style=color:#e6db74>&#39;price&#39;</span>] <span style=color:#f92672>*</span> item[<span style=color:#e6db74>&#39;quantity&#39;</span>]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> total
</span></span></code></pre></div><p>The test still passes, ensuring that your refactoring didn&rsquo;t change the expected outcome.</p><h3 id=exercise>Exercise
<a class=anchor href=#exercise>#</a></h3><ul><li><strong>Exercise 1</strong>: Write a function that needs refactoring and then write corresponding tests for it.</li><li><strong>Exercise 2</strong>: Refactor the function while ensuring that the tests still pass.</li><li><strong>Exercise 3</strong>: Simulate a failure by making an incorrect change in the refactored function and observe how the test helps in catching the error.</li></ul><h3 id=checklist-for-further-learning>Checklist for Further Learning
<a class=anchor href=#checklist-for-further-learning>#</a></h3><ul><li>How can you make sure that your tests are covering all the important aspects of the code?</li><li>What tools and frameworks are available in your language of choice to help write and run tests?</li><li>How can the practice of Test-Driven Development (TDD) be applied when refactoring? How does it differ from writing tests after the code is written?</li><li>What are the best practices for organizing your tests? How can they be maintained and updated as the code evolves?</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/yuhattor/copilot-patterns/commit/e1fd050a41522833d5ef2e5402771278531cbce2 title='Last modified by Yuki Hattori | December 20, 2023' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>December 20, 2023</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#writing-test-code-before-refactoring>Writing test code before refactoring</a><ul><li><a href=#description>Description</a></li><li><a href=#exercise>Exercise</a></li><li><a href=#checklist-for-further-learning>Checklist for Further Learning</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>